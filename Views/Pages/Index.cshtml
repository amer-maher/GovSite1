@model IEnumerable<GovSite.Models.Page>
@{
  ViewBag.Title = "الصفحات";
  Layout = "~/Views/Shared/_AdminLayout.cshtml";
}
<div class="d-flex justify-content-between align-items-center mb-3">
  <h2 class="mb-0">الصفحات</h2>
  <a class="btn btn-primary" asp-action="Create"><i class="bi bi-plus"></i> صفحة جديدة</a>
</div>
<div class="card">
  <div class="table-responsive">
    <table class="table align-middle mb-0">
      <thead class="table-light">
        <tr><th>العنوان</th><th>Slug</th><th>الجهة</th><th>محدثة</th><th class="text-end">إجراءات</th></tr>
      </thead>
      <tbody>
      @foreach (var p in Model) {
        <tr>
          <td>@p.Title</td>
          <td class="text-muted">@p.Slug</td>
          <td>@p.Agency?.Name</td>
          <td>@p.UpdatedAt.ToLocalTime().ToString("yyyy/MM/dd HH:mm")</td>
        <td class="text-end">
  <!-- تعديل -->
  <a class="btn btn-sm btn-outline-secondary"
     asp-action="Edit" asp-route-id="@p.Id" title="تعديل">
    <i class="bi bi-pencil"></i>
  </a>

  <!-- معاينة -->
  <a class="btn btn-sm btn-outline-primary"
     asp-action="Preview" asp-route-id="@p.Id" target="_blank" title="معاينة">
    <i class="bi bi-eye"></i>
  </a>

  <!-- عرض عام -->
  <a class="btn btn-sm btn-outline-info"
     asp-action="PublicLink" asp-route-id="@p.Id" target="_blank" title="فتح كرابط عام">
    <i class="bi bi-box-arrow-up-right"></i>
  </a>

  <!-- حذف (بدون onsubmit) -->
  <form asp-action="Delete" asp-route-id="@p.Id" method="post"
        class="d-inline js-delete" data-title="@p.Title">
    @Html.AntiForgeryToken()
    <button class="btn btn-sm btn-outline-danger" title="حذف">
      <i class="bi bi-trash"></i>
    </button>
  </form>
</td>

        </tr>
      }
      </tbody>
    </table>
  </div>
</div>
@section Scripts {
<script>
document.querySelectorAll('form.js-delete').forEach(f => {
  f.addEventListener('submit', function (e) {
    const name = this.dataset.title || 'هذه الصفحة';
    if (!confirm(`حذف الصفحة "${name}"؟ هذا الإجراء لا يمكن التراجع عنه.`)) {
      e.preventDefault();
    }
  });
});
</script>
}
